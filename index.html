<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>신세계푸드 큰길타워 정반식당</title>
  <style>
    :root{--bg:#0b0f14;--card:#111823;--muted:#94a3b8;--accent:#e6002d;--accent-2:#b80024;--ok:#86efac;--warn:#fde047;--danger:#f87171}
    html,body{margin:0;padding:0;background:linear-gradient(160deg,#0b0f14 0%,#0c1420 50%,#0e1624 100%);color:#e8eef5;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif}
    .wrap{max-width:860px;margin:36px auto;padding:0 16px}
    .card{background:rgba(17,24,35,.9);backdrop-filter: blur(6px);border:1px solid #1f2b3a;border-radius:18px;box-shadow:0 20px 40px rgba(0,0,0,.35);padding:20px}
    .brandbar{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    h1{font-size:24px;margin:0 0 4px}
    .sub{color:var(--muted);font-size:13px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:12px}
    button,select,input,textarea{background:#0f141b;color:#e8eef5;border:1px solid #223041;border-radius:12px;padding:10px 12px;font-size:14px}
    button{cursor:pointer;transition:.2s transform ease}
    button:active{transform:scale(.98)}
    button.primary{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#fff;border:none}
    button.ghost{background:transparent;border:1px dashed #2b3b50;color:#b9c6d3}
    .seg{display:flex;gap:6px;background:#0c1219;border:1px solid #223041;border-radius:12px;padding:4px}
    .seg button{border:none;background:transparent;padding:8px 12px;border-radius:10px}
    .seg button.active{background:var(--accent);color:#fff}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    .menu-today{border:1px solid #253243;border-radius:14px;padding:16px;background:#0b1118}
    .menu-today h2{margin:0 0 6px;font-size:18px}
    .menu-today .date{color:var(--muted);font-size:13px}
    .items{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .pill{display:inline-flex;align-items:center;gap:8px;background:#0f141b;border:1px solid #253243;border-radius:999px;padding:10px 14px;font-size:13px}
    .week{margin-top:16px;padding-top:12px;border-top:1px dashed #2b3b50}
    .day{margin-top:10px}
    .day h3{margin:0 0 6px;font-size:15px;color:#ffb3bf}
    .empty{color:#97a6b5}
    .admin{margin-top:22px}
    details{border:1px solid #2b3b50;border-radius:12px}
    details[open]{background:#0f141b}
    summary{cursor:pointer;padding:12px 14px;font-weight:700}
    .panel{padding:14px}
    .hint{font-size:12px;color:#aab6c2}
    .ok{color:var(--ok)}
    .warn{color:var(--warn)}
    .danger{color:var(--danger)}
    .code{font-family:ui-monospace,Consolas,Menlo,monospace;background:#0b0f14;border:1px solid #223041;border-radius:8px;padding:8px;white-space:pre-wrap}
    .footer{margin-top:16px;color:#7f8b98;font-size:12px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brandbar">
        <div>
          <h1 style="margin:0">신세계푸드 큰길타워 정반식당</h1>
          <div class="sub">클릭 한 번으로 오늘 식단만 확인 · KST 기준 자동 날짜 인식</div>
        </div>
      </div>

      <div class="row">
        <div class="seg" role="tablist" aria-label="보기 전환">
          <button id="btn-today" class="active" aria-selected="true">오늘 메뉴 보기</button>
          <button id="btn-week">이번 주 전체 보기</button>
        </div>
        <select id="campus">
          <option value="main" selected>정반식당</option>
        </select>
        <span class="sub" id="status"></span>
      </div>

      <div class="grid" id="view"></div>

      <div class="admin">
        <details>
          <summary>관리자 입력 / OCR (주말에 주간메뉴 등록)</summary>
          <div class="panel">
            <div class="row">
              <input id="pin" type="password" placeholder="관리자 PIN (기본 2580)" style="max-width:200px"/>
              <button id="btn-auth">관리자 모드 전환</button>
              <span class="hint">공유용 배포 시 코드에서 PIN을 꼭 바꿔주세요.</span>
            </div>

            <div id="admin-area" style="display:none">
              <div class="row">
                <label>적용 주 시작일(월요일): <input id="weekStart" type="date"></label>
                <button id="btn-clear-week" class="ghost">이번 주 데이터 초기화</button>
              </div>

              <h3>1) 텍스트로 붙여넣기</h3>
              <textarea id="txt" rows="8" placeholder="예시\n월) 김치찌개, 제육볶음\n화) 된장찌개, 생선구이\n수) ...\n목) ...\n금) ..." style="width:100%"></textarea>
              <div class="row">
                <button id="btn-apply-text" class="primary">주간메뉴 저장</button>
                <span class="hint">형식에 엄격하지 않아도 됩니다. 요일(월~금)만 명확하면 자동 인식합니다.</span>
              </div>

              <h3>2) 이미지 업로드 후 OCR</h3>
              <input id="img" type="file" accept="image/*"/>
              <div class="row">
                <button id="btn-ocr" class="primary">이미지에서 텍스트 추출(OCR)</button>
                <span class="hint">정확도가 낮으면 텍스트로 수정하세요.</span>
              </div>
              <div id="ocr-out" class="code" style="display:none"></div>

              <h3>3) 수동 입력(선택)</h3>
              <div id="manual"></div>

              <div class="row" style="margin-top:10px">
                <button id="btn-export" class="ghost">백업 내보내기(JSON)</button>
                <input id="importFile" type="file" accept="application/json"/>
                <button id="btn-import" class="ghost">백업 불러오기</button>
              </div>
            </div>
          </div>
        </details>
      </div>

      <div class="footer">
        데이터는 브라우저 <b>LocalStorage</b>에 저장됩니다. 공유하려면 Gist RAW JSON을 <span class="code">?dataUrl=...</span> 로 연결하거나, Firebase/Sheets 연동을 추가하세요.
      </div>
    </div>
  </div>

<script>
const PIN = '2580'; // ✅ 이 값은 로컬에만 저장되며, 다른 사용자는 변경하거나 확인할 수 없습니다.
// 원격 JSON 불러오기(공유용): URL 파라미터 dataUrl 로 지정
const dataUrl = new URLSearchParams(location.search).get('dataUrl');
async function pullRemote(url){
  try{
    setStatus('클라우드에서 메뉴 불러오는 중...','warn');
    const res = await fetch(url, {cache:'no-store'});
    const obj = await res.json();
    save(obj);
    setStatus('클라우드 메뉴가 적용되었습니다.','ok');
  }catch(e){
    console.error(e);
    setStatus('클라우드 메뉴 불러오기에 실패했습니다. 로컬 데이터를 사용합니다.','danger');
  }
}
const KST_OFFSET = 9 * 60;
const storeKey = 'cafeteria.menus.v1';
const weekdays = ['월','화','수','목','금'];

function tzNow(){return new Date(new Date().getTime()+(new Date().getTimezoneOffset()+KST_OFFSET)*60000)}
function startOfWeekMonday(d){const x=new Date(d);const day=(x.getDay()+6)%7;x.setDate(x.getDate()-day);x.setHours(0,0,0,0);return x;}
function fmtDate(d){const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const da=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${da}`}
function addDays(d,n){const x=new Date(d);x.setDate(x.getDate()+n);return x;}
function load(){try{return JSON.parse(localStorage.getItem(storeKey))||{}}catch(e){return {}}}
function save(db){localStorage.setItem(storeKey,JSON.stringify(db))}
function setStatus(msg,cls=''){const el=document.getElementById('status');el.textContent=msg;el.className=cls}

function renderToday(){const view=document.getElementById('view');view.innerHTML='';const db=load();const today=tzNow();const key=fmtDate(today);const data=db[key];const card=document.createElement('div');card.className='menu-today';const weekStr=['일','월','화','수','목','금','토'][today.getDay()];card.innerHTML=`<h2>오늘의 메뉴</h2><div class='date'>${key} (${weekStr})</div>`;const itemsDiv=document.createElement('div');itemsDiv.className='items';if(data?.items?.length){data.items.forEach(t=>{const pill=document.createElement('div');pill.className='pill';pill.textContent=t.trim();itemsDiv.appendChild(pill)});const src=data.meta?.source||'수동';const srcSpan=document.createElement('div');srcSpan.className='sub';srcSpan.style.marginTop='8px';srcSpan.textContent=`출처: ${src.toUpperCase()} · 저장일: ${new Date(data.meta?.updated||'').toLocaleString()}`;itemsDiv.appendChild(srcSpan)}else{const emp=document.createElement('div');emp.className='empty';emp.textContent='오늘 데이터가 없습니다.';itemsDiv.appendChild(emp)}card.appendChild(itemsDiv);view.appendChild(card)}

function renderWeek(){const view=document.getElementById('view');view.innerHTML='';const db=load();const monday=startOfWeekMonday(tzNow());const wrap=document.createElement('div');wrap.className='week';for(let i=0;i<5;i++){const d=addDays(monday,i);const key=fmtDate(d);const day=document.createElement('div');day.className='day';const wname=weekdays[i];const head=document.createElement('h3');head.textContent=`${wname} (${key})`;day.appendChild(head);const data=db[key];if(data?.items?.length){const items=document.createElement('div');items.className='items';data.items.forEach(t=>{const p=document.createElement('div');p.className='pill';p.textContent=t;items.appendChild(p)});day.appendChild(items)}else{const emp=document.createElement('div');emp.className='empty';emp.textContent='등록된 메뉴 없음';day.appendChild(emp)}wrap.appendChild(day)}view.appendChild(wrap)}

document.getElementById('btn-today').addEventListener('click',()=>{renderToday();document.getElementById('btn-today').classList.add('active');document.getElementById('btn-week').classList.remove('active')})
document.getElementById('btn-week').addEventListener('click',()=>{renderWeek();document.getElementById('btn-week').classList.add('active');document.getElementById('btn-today').classList.remove('active')})
(async()=>{ if(dataUrl){ await pullRemote(dataUrl); } renderToday(); })();
  // 관리자 기능 숨기기 (공유용 보기 전용 모드)
if(!localStorage.getItem('adminAccess')){
  document.querySelector('.admin').style.display='none';
}
</script>
</body>
</html>
